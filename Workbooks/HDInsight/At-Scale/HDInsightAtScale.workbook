{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{LogAnalyticsWorkspaces}"
        ],
        "parameters": [
          {
            "id": "df624d07-1a42-4d88-8ea8-dbf675081a98",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "description": "Subscription of Log Analytics Workspace containing your clusters' data",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "Resources | where type =~ \"microsoft.hdinsight/clusters\" \r\n| distinct subscriptionId | order by subscriptionId | project subscriptionId, label=subscriptionId, selected=row_number()==1",
            "crossComponentResources": [
              "value::all"
            ],
            "value": [],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "b73367a6-702d-4f86-b908-ac5335be25de",
            "version": "KqlParameterItem/1.0",
            "name": "LogAnalyticsWorkspaces",
            "type": 5,
            "description": "Select the Log Analytics workspaces you would like to see metrics for. Limited to 100 workspaces or workspaces in more than 25 different regions.",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n|  order by name asc\r\n| extend Rank = row_number()\r\n| project value = id, label = id, selected = Rank <= 5",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.operationalinsights/workspaces": true
              },
              "limitSelectTo": 100,
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "47565476-ecba-4f53-80fc-14cbdcc779e9",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "description": "Time range used for queries ",
            "isRequired": true,
            "value": {
              "durationMs": 300000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 0"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "02344c0b-1cda-414f-aff0-47d2999560a8",
            "cellValue": "monitor_tab",
            "linkTarget": "parameter",
            "linkLabel": "Monitored",
            "subTarget": "Monitored",
            "style": "link"
          },
          {
            "id": "a3b615be-9ea2-4532-9454-7009279243aa",
            "cellValue": "monitor_tab",
            "linkTarget": "parameter",
            "linkLabel": "Unmonitored",
            "subTarget": "Unmonitored",
            "style": "link"
          }
        ]
      },
      "name": "links - 9"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "762576d3-25ec-4079-8c2d-326d89e39fd2",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Overview",
                  "subTarget": "Overview",
                  "style": "link"
                },
                {
                  "id": "95e5d4d8-622c-4b43-9997-d2786e5c8d97",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "HBase",
                  "subTarget": "HBase",
                  "style": "link"
                },
                {
                  "id": "3895f2fc-411b-4335-a11b-fe1ac1abde48",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Hive",
                  "subTarget": "Hive",
                  "style": "link"
                },
                {
                  "id": "1e34bf2d-acdf-4f89-a4a9-53441cef3d39",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Kafka",
                  "subTarget": "Kafka",
                  "style": "link"
                },
                {
                  "id": "0847ac85-85af-43cc-b916-9342b7dd9a5c",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Spark",
                  "subTarget": "Spark",
                  "style": "link"
                },
                {
                  "id": "431c8743-530d-4cc4-b978-c7fd1398974d",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Storm",
                  "subTarget": "Storm",
                  "style": "link"
                },
                {
                  "id": "3b099e67-4366-4fda-87d1-270a8457194b",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "YARN",
                  "subTarget": "YARN",
                  "style": "link"
                }
              ]
            },
            "name": "links - 2"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{LogAnalyticsWorkspaces}"
              ],
              "parameters": [
                {
                  "id": "850b6bc9-fc59-40e1-9505-1e6d0b7c2b23",
                  "version": "KqlParameterItem/1.0",
                  "name": "Clusters",
                  "type": 2,
                  "description": "Clusters emitting logs to the selected workspaces within the selected time range. Deafults to all selected. Unselect clusters you wish to not see in the aggregations.",
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "HDInsightAmbariSystemMetrics\r\n| distinct ClusterName",
                  "crossComponentResources": [
                    "{LogAnalyticsWorkspaces}"
                  ],
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "4a87cc64-aca7-4896-97f2-c15aadb6e331",
                  "version": "KqlParameterItem/1.0",
                  "name": "overview_usage",
                  "type": 1,
                  "isRequired": true,
                  "query": "\r\nlet hasNonEmptyTable = (T:string, T2:string) \r\n{ \r\n   toscalar( \r\n   union isfuzzy=true \r\n   ( table(T) |  where ClusterName in ({Clusters}) | take 1 | count as Count ),\r\n   ( table(T2) |  where ClusterName in ({Clusters})| take 1 | count as Count),\r\n   (print Count=0) \r\n   | summarize sum(Count) \r\n   ) > 1\r\n};\r\nlet TableName = 'HDInsightAmbariSystemMetrics';\r\nlet TableName2 = 'HDInsightAmbariClusterAlerts';\r\nprint  IsPresent=iif(hasNonEmptyTable(TableName,TableName2 ), \"present\", \"not present\")",
                  "crossComponentResources": [
                    "{LogAnalyticsWorkspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "a422703d-cb35-4dfc-bc90-ea7cb8eeab15",
                  "version": "KqlParameterItem/1.0",
                  "name": "kafka_usage",
                  "type": 1,
                  "isRequired": true,
                  "query": "let hasNonEmptyTable = (T:string, T2:string) \r\n{ \r\n   toscalar( \r\n   union isfuzzy=true \r\n   ( table(T) | where ClusterName in ({Clusters}) | take 1 | count as Count ),\r\n   ( table(T2)| where ClusterName in ({Clusters}) | take 1 | count as Count),\r\n   (print Count=0) \r\n   | summarize sum(Count) \r\n   ) > 1\r\n};\r\nlet TableName = 'HDInsightKafkaMetrics';\r\nlet TableName2 = 'HDInsightAmbariSystemMetrics';\r\nprint  IsPresent=iif(hasNonEmptyTable(TableName,TableName2 ), \"present\", \"not present\")",
                  "crossComponentResources": [
                    "{LogAnalyticsWorkspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "a91f8295-384a-43cd-b737-43489bea9f30",
                  "version": "KqlParameterItem/1.0",
                  "name": "hbase_usage",
                  "type": 1,
                  "isRequired": true,
                  "query": "let hasNonEmptyTable = (T:string, T2:string) \r\n{ \r\n   toscalar( \r\n   union isfuzzy=true \r\n   ( table(T) |  where ClusterName in ({Clusters}) | take 1 | count as Count ),\r\n   ( table(T2) | where ClusterName in ({Clusters}) | take 1 | count as Count),\r\n   (print Count=0) \r\n   | summarize sum(Count) \r\n   ) > 1\r\n};\r\nlet TableName = 'HDInsightHBaseMetrics';\r\nlet TableName2 = 'HDInsightAmbariSystemMetrics';\r\nprint  IsPresent=iif(hasNonEmptyTable(TableName,TableName2 ), \"present\", \"not present\")",
                  "crossComponentResources": [
                    "{LogAnalyticsWorkspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "3eed69d7-8c09-4d88-b252-2b105e23c9e0",
                  "version": "KqlParameterItem/1.0",
                  "name": "hive_usage",
                  "type": 1,
                  "isRequired": true,
                  "query": "let hasNonEmptyTable = (T:string, T2:string) \r\n{ \r\n   toscalar( \r\n   union isfuzzy=true \r\n   ( table(T) | where ClusterName in ({Clusters}) | take 1 | count as Count ),\r\n   ( table(T2) | where ClusterName in ({Clusters}) | take 1 | count as Count),\r\n   (print Count=0) \r\n   | summarize sum(Count) \r\n   ) > 1\r\n};\r\nlet TableName = 'HDInsightAmbariSystemMetrics';\r\nlet TableName2 = 'HDInsightHiveAndLLAPMetrics';\r\nprint  IsPresent=iif(hasNonEmptyTable(TableName,TableName2 ), \"present\", \"not present\")",
                  "crossComponentResources": [
                    "{LogAnalyticsWorkspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "9b42ff84-1013-4bf0-a789-e49db5cfc71d",
                  "version": "KqlParameterItem/1.0",
                  "name": "storm_usage",
                  "type": 1,
                  "isRequired": true,
                  "query": "let hasNonEmptyTable = (T:string, T2:string) \r\n{ \r\n   toscalar( \r\n   union isfuzzy=true \r\n   ( table(T) | where ClusterName in ({Clusters}) | take 1 | count as Count ),\r\n   ( table(T2) | where ClusterName in ({Clusters}) | take 1 | count as Count),\r\n   (print Count=0) \r\n   | summarize sum(Count) \r\n   ) > 1\r\n};\r\nlet TableName = 'HDInsightStormMetrics';\r\nlet TableName2 = 'HDInsightStormTopologyMetrics';\r\nprint  IsPresent=iif(hasNonEmptyTable(TableName,TableName2 ), \"present\", \"not present\")",
                  "crossComponentResources": [
                    "{LogAnalyticsWorkspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "bcde04c2-bebe-470f-b28d-ba7788806ecd",
                  "version": "KqlParameterItem/1.0",
                  "name": "spark_usage",
                  "type": 1,
                  "isRequired": true,
                  "query": "let hasNonEmptyTable = (T:string, T2:string) \r\n{ \r\n   toscalar( \r\n   union isfuzzy=true \r\n   ( table(T) | where ClusterName in ({Clusters}) | take 1 | count as Count ),\r\n   ( table(T2) | where ClusterName in ({Clusters}) | take 1 | count as Count),\r\n   (print Count=0) \r\n   | summarize sum(Count) \r\n   ) > 1\r\n};\r\nlet TableName = 'HDInsightAmbariSystemMetrics';\r\nlet TableName2 = 'HDInsightSparkApplicationEvents';\r\nprint  IsPresent=iif(hasNonEmptyTable(TableName,TableName2 ), \"present\", \"not present\")",
                  "crossComponentResources": [
                    "{LogAnalyticsWorkspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "6a076174-30c0-4c2f-b525-b803d5408f71",
                  "version": "KqlParameterItem/1.0",
                  "name": "yarn_usage",
                  "type": 1,
                  "isRequired": true,
                  "query": "let hasNonEmptyTable = (T:string, T2:string) \r\n{ \r\n   toscalar( \r\n   union isfuzzy=true \r\n   ( table(T) | where ClusterName in ({Clusters}) | take 1 | count as Count ),\r\n   ( table(T2) | where ClusterName in ({Clusters}) | take 1 | count as Count),\r\n   (print Count=0) \r\n   | summarize sum(Count) \r\n   ) > 1\r\n};\r\nlet TableName = 'HDInsightAmbariSystemMetrics';\r\nlet TableName2 = 'HDInsightHadoopAndYarnMetrics';\r\nprint  IsPresent=iif(hasNonEmptyTable(TableName,TableName2 ), \"present\", \"not present\")",
                  "crossComponentResources": [
                    "{LogAnalyticsWorkspaces}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 7"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Clusters Overview",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightAmbariSystemMetrics\r\n| where ClusterName in ({Clusters})\r\n| distinct ClusterName, HostName\r\n| summarize NodeCount = count() by ClusterName\r\n| join kind=fullouter (HDInsightAmbariClusterAlerts\r\n| distinct ClusterName, ClusterType) \r\non ClusterName\r\n| join kind=leftouter (HDInsightAmbariClusterAlerts\r\n| where State == \"CRITICAL\"\r\n| summarize CriticalAlerts = dcount(AlertID) by ClusterName)\r\non ClusterName\r\n| extend CriticalAlerts = iff(isempty(CriticalAlerts), 0, CriticalAlerts)\r\n| join kind=leftouter (HDInsightAmbariSystemMetrics\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, HostName\r\n| summarize DiskPercentUsed = (1 - sum(DiskFree)/sum(DiskTotal))*100, CPUUsagePercentage = sum(CpuSystem + CpuUser + CpuIOWait) / sum(NumberOfCpu), FreeMemoryBytes = sum(FreeMemory) by ClusterName)\r\non ClusterName\r\n| project ClusterName, NodeCount, ClusterType, CriticalAlerts, DiskPercentUsed,  CPUUsagePercentage, FreeMemoryBytes",
                    "size": 0,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "DiskPercentUsed",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "CPUUsagePercentage",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "FreeMemoryBytes",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "tab",
                    "comparison": "isEqualTo"
                  },
                  "name": "ClusterMetrics"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type =~ 'microsoft.hdinsight/clusters' | project  name, id",
                    "size": 0,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "tab",
                    "comparison": "isEqualTo"
                  },
                  "name": "ClusterResourceInfo"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"ffd5d871-3f9e-43e0-8a4f-497a1a750098\",\"mergeType\":\"inner\",\"leftTable\":\"ClusterMetrics\",\"rightTable\":\"ClusterResourceInfo\",\"leftColumn\":\"ClusterName\",\"rightColumn\":\"name\"}],\"projectRename\":[{\"originalName\":\"[ClusterResourceInfo].id\",\"mergedName\":\"ClusterName\",\"fromId\":\"ffd5d871-3f9e-43e0-8a4f-497a1a750098\"},{\"originalName\":\"[ClusterMetrics].NodeCount\",\"mergedName\":\"NodeCount\",\"fromId\":\"ffd5d871-3f9e-43e0-8a4f-497a1a750098\"},{\"originalName\":\"[ClusterMetrics].ClusterType\",\"mergedName\":\"ClusterType\",\"fromId\":\"ffd5d871-3f9e-43e0-8a4f-497a1a750098\"},{\"originalName\":\"[ClusterMetrics].CriticalAlerts\",\"mergedName\":\"CriticalAlerts\",\"fromId\":\"ffd5d871-3f9e-43e0-8a4f-497a1a750098\"},{\"originalName\":\"[ClusterMetrics].DiskPercentUsed\",\"mergedName\":\"DiskPercentUsed\",\"fromId\":\"ffd5d871-3f9e-43e0-8a4f-497a1a750098\"},{\"originalName\":\"[ClusterMetrics].CPUUsagePercentage\",\"mergedName\":\"CPUUsagePercentage\",\"fromId\":\"ffd5d871-3f9e-43e0-8a4f-497a1a750098\"},{\"originalName\":\"[ClusterMetrics].FreeMemoryBytes\",\"mergedName\":\"FreeMemoryBytes\",\"fromId\":\"ffd5d871-3f9e-43e0-8a4f-497a1a750098\"},{\"originalName\":\"[ClusterResourceInfo].name\"},{\"originalName\":\"[ClusterMetrics].ClusterName\"}]}",
                    "size": 0,
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ClusterName",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "subTarget": "azuremonitor",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "DiskPercentUsed",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "CPUUsagePercentage",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "FreeMemoryBytes",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ]
                    }
                  },
                  "showPin": false,
                  "name": "query - 2"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Overview"
              },
              {
                "parameterName": "overview_usage",
                "comparison": "isEqualTo",
                "value": "present"
              }
            ],
            "name": "Overview"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName in ({Clusters})\r\n| where TimeGenerated {TimeRange}\r\n| distinct ClusterName, HostName\r\n| count\r\n| extend TimeGenerated = now()\r\n| extend Name = \"BrokerCount\"",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false,
                      "sortCriteriaField": "Count"
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName in ({Clusters})\r\n| where TimeGenerated {TimeRange}\r\n| evaluate pivot(MetricName, avg(MetricValue), TimeGenerated, ClusterName, HostName)\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, HostName\r\n| summarize PartitionCount = sum(PartitionCount) by bin(TimeGenerated, 5m)\r\n| sort by TimeGenerated desc\r\n| take 1\r\n| extend Name = \"PartitionCount\"",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "PartitionCount",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false,
                      "sortCriteriaField": "Count"
                    }
                  },
                  "customWidth": "25",
                  "name": "Partition Count"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName in ({Clusters})\r\n| where TimeGenerated {TimeRange}\r\n| evaluate pivot(MetricName, avg(MetricValue), TimeGenerated, ClusterName, HostName)\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, HostName\r\n| summarize UnderreplicatedPartitions = sum(UnderReplicatedPartitions) by bin(TimeGenerated, {TimeRange:grain})\r\n| extend Name = \"UnderreplicatedPartitions\"\r\n| sort by TimeGenerated desc\r\n| take 1",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "UnderreplicatedPartitions",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false,
                      "sortCriteriaField": "Count"
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 1 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName in ({Clusters})\r\n| where TimeGenerated {TimeRange}\r\n| evaluate pivot(MetricName, avg(MetricValue), TimeGenerated, ClusterName, HostName)\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, HostName\r\n| summarize OfflinePartitions = sum(OfflinePartitionsCount) by bin(TimeGenerated, 5m)\r\n| sort by TimeGenerated desc\r\n| take 1\r\n| extend Name = \"OfflinePartitions\"",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "OfflinePartitions",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false,
                      "sortCriteriaField": "Count"
                    }
                  },
                  "customWidth": "25",
                  "name": "Offline Partitions"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName in ({Clusters})\r\n| where TimeGenerated {TimeRange}\r\n| evaluate pivot(MetricName, avg(MetricValue), TimeGenerated, ClusterName, HostName)\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, HostName\r\n| summarize BytesInPerSec = sum(BytesInPerSec) by bin(TimeGenerated, {TimeRange:grain})\r\n| sort by TimeGenerated desc\r\n| take 1\r\n| extend Name = \"BytesInPerSec\"",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "BytesInPerSec",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 11,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      "showBorder": false,
                      "sortCriteriaField": "Count"
                    }
                  },
                  "customWidth": "25",
                  "name": "BytesInPerSec"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName in ({Clusters})\r\n| where TimeGenerated {TimeRange}\r\n| evaluate pivot(MetricName, avg(MetricValue), TimeGenerated, ClusterName, HostName)\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, HostName\r\n| summarize BytesOutPerSec = sum(BytesOutPerSec) by bin(TimeGenerated, {TimeRange:grain})\r\n| sort by TimeGenerated desc\r\n| take 1\r\n| extend Name = \"BytesOutPerSec\"",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "BytesOutPerSec",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 11,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      "showBorder": false,
                      "sortCriteriaField": "Count"
                    }
                  },
                  "customWidth": "25",
                  "name": "BytesInPerSec - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName in ({Clusters})\r\n| where TimeGenerated {TimeRange}\r\n| evaluate pivot(MetricName, avg(MetricValue), TimeGenerated, ClusterName, HostName)\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, HostName\r\n| summarize OfflineLogDirectories = sum(OfflineLogDirectoryCount) by bin(TimeGenerated, {TimeRange:grain})\r\n| sort by TimeGenerated\r\n| take 1\r\n| extend Name = \"OfflineLogDirectories\"",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "OfflineLogDirectories",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      "showBorder": false,
                      "sortCriteriaField": "Count"
                    }
                  },
                  "customWidth": "25",
                  "name": "BytesInPerSec - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName in ({Clusters})\r\n| where TimeGenerated {TimeRange}\r\n| evaluate pivot(MetricName, avg(MetricValue), TimeGenerated, ClusterName, HostName)\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, HostName\r\n| summarize UncleanLeaderElectionsPerSec = sum(UncleanLeaderElectionsPerSec) by bin(TimeGenerated, {TimeRange:grain})\r\n| sort by TimeGenerated desc\r\n| take 1\r\n| extend Name = \"UncleanLeaderElectionsPerSec\"",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "UncleanLeaderElectionsPerSec",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 31,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      "showBorder": false,
                      "sortCriteriaField": "Count"
                    }
                  },
                  "customWidth": "25",
                  "name": "UncleanLeaderElectionsPerSec"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightKafkaMetrics\r\n| where ClusterName in ({Clusters})\r\n| evaluate pivot(MetricName, avg(MetricValue), TimeGenerated, ClusterName, HostName)\r\n| summarize arg_max(TimeGenerated,*) by ClusterName, HostName\r\n| summarize ActiveControllerCount = sum(ActiveControllerCount),  LeaderCount = sum(LeaderCount), PartitionCount = sum(PartitionCount), UnderReplicatedPartitions = sum(UnderReplicatedPartitions), OfflinePartitions = sum(OfflinePartitionsCount), OfflineLogDirectories = sum(OfflineLogDirectoryCount), BytesInPerSec = sum(BytesInPerSec), BytesOutPerSec = sum(BytesOutPerSec) by ClusterName\r\n",
                    "size": 0,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ]
                  },
                  "name": "query - 0"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Kafka"
              },
              {
                "parameterName": "kafka_usage",
                "comparison": "isEqualTo",
                "value": "present"
              }
            ],
            "name": "Kafka"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightHBaseMetrics\r\n| where ClusterName in ({Clusters})\r\n| where MetricName == \"numRegionServers\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName,HostName\r\n| summarize NumRegionServers = sum(MetricValue) by bin(TimeGenerated, 5m)\r\n| extend Name = \"NumRegionServers\"\r\n| sort by TimeGenerated desc\r\n| take 1\r\n",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "NumRegionServers",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "Number of Region Servers"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightHBaseMetrics\r\n| where ClusterName in ({Clusters})\r\n| where MetricName == \"numDeadRegionServers\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName,HostName\r\n| summarize DeadRegionServers = sum(MetricValue) by bin(TimeGenerated, 5m)\r\n| extend Name = \"DeadRegionServers\"\r\n| sort by TimeGenerated desc\r\n| take 1\r\n",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "DeadRegionServers",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "Number of Region Servers - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightHBaseMetrics\r\n| where ClusterName in ({Clusters})\r\n| where MetricName == \"regionCount\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName,HostName\r\n| summarize NumRegions = sum(MetricValue) by bin(TimeGenerated, 5m)\r\n| extend Name = \"NumRegions\"\r\n| sort by TimeGenerated desc\r\n| take 1\r\n",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "NumRegions",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "Number of Region Servers - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightHBaseMetrics\r\n| where ClusterName in ({Clusters})\r\n| where MetricName == \"writtenBytes\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName,HostName\r\n| summarize WrittenBytes = sum(MetricValue) by bin(TimeGenerated, 5m)\r\n| extend Name = \"WrittenBytes\"\r\n| sort by TimeGenerated desc\r\n| take 1\r\n",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name"
                      },
                      "leftContent": {
                        "columnMatch": "WrittenBytes",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "Number of Region Servers - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightHBaseMetrics\r\n| where ClusterName in ({Clusters})\r\n| where MetricNamespace == \"Hadoop:service=HBase,name=Master,sub=Server\"\r\n| where MetricName == \"numRegionServers\" or MetricName == \"numDeadRegionServers\"\r\n| evaluate pivot(MetricName, avg(MetricValue), ClusterName, HostName, TimeGenerated, Tags)\r\n| summarize arg_max(TimeGenerated,*) by ClusterName, HostName\r\n| extend TagsJson = parse_json(Tags)\r\n| where TagsJson[\"tag.isActiveMaster\"] == true\r\n| summarize NumberOfRegionServers = avg(numRegionServers), NumberOfDeadRegionServers = avg(numDeadRegionServers) by ClusterName\r\n| join (HDInsightHBaseMetrics\r\n| where MetricNamespace == \"Hadoop:service=HBase,name=RegionServer,sub=Server\"\r\n| where MetricName == \"regionCount\" or MetricName == \"hlogFileCount\" or  MetricName == \"storeFileCount\" or  MetricName == \"blockCacheCountHitPercent\" or  MetricName == \"readRequestCount\" or MetricName == \"writeRequestCount\"\r\n| evaluate pivot(MetricName, avg(MetricValue), ClusterName, HostName, TimeGenerated)\r\n| summarize arg_max(TimeGenerated,*) by ClusterName, HostName\r\n| summarize RegionCount = sum(regionCount), HLogFileCount = sum(hlogFileCount), StoreFileCount = sum(storeFileCount), BlockCacheHitPercent = avg(blockCacheCountHitPercent), ReadRequestCount = sum(readRequestCount), WriteRequestCount = sum(writeRequestCount) by ClusterName)\r\non ClusterName\r\n| project ClusterName, NumberOfRegionServers, NumberOfDeadRegionServers, RegionCount, HLogFileCount, BlockCacheHitPercent, ReadRequestCount, WriteRequestCount\r\n \r\n\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "BlockCacheHitPercent",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 4"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "HBase"
              },
              {
                "parameterName": "hbase_usage",
                "comparison": "isEqualTo",
                "value": "present"
              }
            ],
            "name": "group - 4"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightHadoopAndYarnMetrics\r\n| where ClusterName in ({Clusters})\r\n| where MetricName == \"NumActiveNMs\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName\r\n| summarize NumActiveNMs = sum(MetricValue) by bin(TimeGenerated, {TimeRange:grain})\r\n| extend Name = \"NumActiveNMs\"\r\n| order by TimeGenerated desc\r\n| take 1",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "NumActiveNMs",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightHadoopAndYarnMetrics\r\n| where ClusterName in ({Clusters})\r\n| where MetricName == \"NumUnhealthyNMs\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName\r\n| summarize NumUnhealthyNMs = sum(MetricValue) by bin(TimeGenerated, {TimeRange:grain})\r\n| extend Name = \"NumUnhealthyNMs\"\r\n| order by TimeGenerated desc\r\n| take 1",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "NumUnhealthyNMs",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightHadoopAndYarnMetrics\r\n| where ClusterName in ({Clusters})\r\n| where MetricName == \"AppsRunning\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName\r\n| summarize AppsRunning = sum(MetricValue) by bin(TimeGenerated, {TimeRange:grain})\r\n| extend Name = \"AppsRunning\"\r\n| order by TimeGenerated desc\r\n| take 1",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "AppsRunning",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightHadoopAndYarnMetrics\r\n| where ClusterName in ({Clusters})\r\n| where MetricName == \"AppsFailed\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName\r\n| summarize AppsFailed = sum(MetricValue) by bin(TimeGenerated, {TimeRange:grain})\r\n| extend Name = \"AppsFailed\"\r\n| order by TimeGenerated desc\r\n| take 1",
                    "size": 4,
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "AppsFailed",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0 - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightHadoopAndYarnMetrics\r\n| where ClusterName in ({Clusters})\r\n| where HostName startswith(\"hn\")\r\n| evaluate pivot(MetricName, max(MetricValue), TimeGenerated, ClusterName, HostName)\r\n| summarize arg_max(TimeGenerated,*) by ClusterName\r\n| summarize NumActiveNMs = sum(NumActiveNMs), NumUnhealthyNMs = sum(NumUnhealthyNMs),AppsRunning = sum(AppsRunning), AppsFailed = sum(AppsFailed), ClusterMemoryAvailable = sum(AvailableMB), ResourceManagerHeapUsage = sum(MemHeapUsedM) by ClusterName\r\n| project ClusterName, NumActiveNMs, NumUnhealthyNMs,AppsRunning, AppsFailed, ClusterMemoryAvailable \r\n",
                    "size": 0,
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ClusterMemoryAvailable",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 4,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "ResourceManagerHeapUsage",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 4,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 4"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightHiveAndLLAPMetrics\r\n| where MetricName == \"NumActiveSources\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName\r\n| summarize NumActiveSources = sum(MetricValue) by bin(TimeGenerated, {TimeRange:grain})\r\n| extend Name = \"NumActiveSources\"\r\n| order by TimeGenerated desc\r\n| take 1",
                          "size": 4,
                          "timeContext": {
                            "durationMs": 2419200000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{LogAnalyticsWorkspaces}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Name"
                            },
                            "leftContent": {
                              "columnMatch": "NumActiveSources",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 7"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightHiveAndLLAPMetrics\r\n| where MetricName == \"NumActiveSinks\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName\r\n| summarize NumActiveSinks = sum(MetricValue) by bin(TimeGenerated, {TimeRange:grain})\r\n| extend Name = \"NumActiveSinks\"\r\n| order by TimeGenerated desc\r\n| take 1",
                          "size": 4,
                          "timeContext": {
                            "durationMs": 2419200000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{LogAnalyticsWorkspaces}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Name"
                            },
                            "leftContent": {
                              "columnMatch": "NumActiveSinks",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 7 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "HDInsightHiveAndLLAPMetrics\r\n| where MetricName == \"NumActiveSinks\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName\r\n| summarize NumActiveSinks = sum(MetricValue) by bin(TimeGenerated, {TimeRange:grain})\r\n| extend Name = \"NumActiveSinks\"\r\n| order by TimeGenerated desc\r\n| take 1",
                          "size": 4,
                          "timeContext": {
                            "durationMs": 2419200000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{LogAnalyticsWorkspaces}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "Name"
                            },
                            "leftContent": {
                              "columnMatch": "NumActiveSinks",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 7 - Copy - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "tab",
                    "comparison": "isEqualTo",
                    "value": "Hive"
                  },
                  "name": "Hive"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "YARN"
              },
              {
                "parameterName": "yarn_usage",
                "comparison": "isEqualTo",
                "value": "present"
              }
            ],
            "name": "YARN"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightStormTopologyMetrics\r\n| where ClusterName in ({Clusters})\r\n| where Status == \"ACTIVE\" and TimeGenerated > ago(30m)\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, TopologyId\r\n| count\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Active Topologies",
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightStormTopologyMetrics\r\n| where ClusterName in ({Clusters})\r\n| where Status == \"ACTIVE\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, TopologyId\r\n| summarize sum(WorkersTotal) by ClusterType\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Total Workers",
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "sum_WorkersTotal",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightStormTopologyMetrics\r\n| where ClusterName in ({Clusters})\r\n| where Status == \"ACTIVE\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, TopologyId\r\n| summarize sum(ExecutorsTotal) by ClusterType\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Total Executors",
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "sum_ExecutorsTotal",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightStormTopologyMetrics\r\n| where ClusterName in ({Clusters})\r\n| where Status == \"ACTIVE\"\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, TopologyId\r\n| summarize sum(TasksTotal) by ClusterType\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Total Tasks",
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "sum_TasksTotal",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0 - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightStormTopologyMetrics\r\n| where ClusterName in ({Clusters})\r\n| where  InstanceName == \"bolt\" \r\n| summarize arg_max(TimeGenerated,*) by ClusterName, TopologyId, BoltId\r\n| summarize Acked = sum(Acked) by bin(TimeGenerated, {TimeRange:grain})\r\n| sort by TimeGenerated desc\r\n| take 1\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Acked",
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "Acked",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0 - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightStormTopologyMetrics\r\n| where ClusterName in ({Clusters})\r\n| where  InstanceName == \"topology_stats\" and Id == \":all-time\"\r\n| summarize arg_max(TimeGenerated,*) by ClusterName, TopologyId\r\n| summarize Emitted = sum(Emitted) by bin(TimeGenerated, {TimeRange:grain})\r\n| sort by TimeGenerated desc\r\n| take 1\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Emitted",
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "Emitted",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0 - Copy - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightStormTopologyMetrics\r\n| where ClusterName in ({Clusters})\r\n| where  InstanceName == \"topology_stats\" and Id == \":all-time\"\r\n| summarize arg_max(TimeGenerated,*) by ClusterName, TopologyId\r\n| summarize Transferred = sum(Transferred) by bin(TimeGenerated, {TimeRange:grain})\r\n| sort by TimeGenerated desc\r\n| take 1\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Transferred",
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "Transferred",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0 - Copy - Copy - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightStormTopologyMetrics\r\n| where ClusterName in ({Clusters})\r\n| where  InstanceName == \"topology_stats\" and Id == \":all-time\"\r\n| summarize arg_max(TimeGenerated,*) by ClusterName, TopologyId\r\n| summarize Failed = sum(Failed) by bin(TimeGenerated, {TimeRange:grain})\r\n| sort by TimeGenerated desc\r\n| take 1\r\n",
                    "size": 4,
                    "showAnalytics": true,
                    "title": "Failed",
                    "timeContext": {
                      "durationMs": 300000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "Failed",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "25",
                  "name": "query - 0 - Copy - Copy - Copy - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightStormTopologyMetrics\r\n| where ClusterName in ({Clusters})\r\n| where Status == \"ACTIVE\" and TimeGenerated {TimeRange}\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, TopologyId\r\n| summarize TopologyCount=count(TopologyId),WorkersTotal = sum(WorkersTotal), ExecutorsTotal = sum(ExecutorsTotal), TasksTotal = sum(TasksTotal), AssignedTotalMemMB = sum(AssignedTotalMemMB) by ClusterName\r\n| project  ClusterName, TopologyCount, WorkersTotal, ExecutorsTotal, TasksTotal, AssignedTotalMemMB\r\n| join kind=fullouter (HDInsightStormMetrics\r\n| distinct ClusterName)\r\non ClusterName\r\n| extend TopologyCount = iff(isempty(TopologyCount), 0, tolong(TopologyCount))\r\n| extend WorkersTotal = iff(isempty(WorkersTotal), 0, tolong(WorkersTotal))\r\n| extend ExecutorsTotal = iff(isempty(ExecutorsTotal), 0, tolong(ExecutorsTotal))\r\n| extend TasksTotal = iff(isempty(TasksTotal),0, tolong(TasksTotal))\r\n| extend AssignedTotalMemMB = iff(isempty(AssignedTotalMemMB), 0, tolong(AssignedTotalMemMB))\r\n| extend ClusterName = ClusterName1\r\n| project ClusterName, TopologyCount, WorkersTotal, ExecutorsTotal, TasksTotal, AssignedTotalMemMB",
                    "size": 0,
                    "showAnalytics": true,
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AssignedTotalMemMB",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 4,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 6"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Storm"
              },
              {
                "parameterName": "storm_usage",
                "comparison": "isEqualTo",
                "value": "present"
              }
            ],
            "name": "Storm"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightHiveAndLLAPMetrics\r\n| where ClusterName in ({Clusters})\r\n| where HostName contains \"wn\"\r\n| evaluate pivot(MetricName, avg(MetricValue), TimeGenerated, ClusterName, HostName)\r\n| summarize arg_max(TimeGenerated,*) by ClusterName, HostName\r\n| summarize TotalExecutors=sum(NumExecutors), TotalAvailableExecutors=sum(ExecutorNumExecutorsAvailable), AvgExecutorFreeSlots=avg(ExecutorAvailableFreeSlotsPercent), TotalExecutorMemory=sum(ExecutorMemoryPerInstance), TotalCacheMemory=sum(ExecutorCacheMemoryPerInstance), AvgFreeCacheCapacity=avg(CacheCapacityRemainingPercentage), AvgCacheHitRatio=avg(CacheHitRatio), TotalJvmMemory=sum(ExecutorJvmMaxMemory) by ClusterName\r\n\r\n",
                    "size": 0,
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AvgExecutorFreeSlots",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 1,
                            "palette": "redGreen"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "percent",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "TotalExecutorMemory",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "TotalCacheMemory",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "AvgFreeCacheCapacity",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 1,
                            "palette": "redGreen"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "percent"
                            }
                          }
                        },
                        {
                          "columnMatch": "AvgCacheHitRatio",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 1,
                            "palette": "redGreen"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "percent"
                            }
                          }
                        },
                        {
                          "columnMatch": "TotalJvmMemory",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "AvgFreeCacheCapacity",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "AvgFreeCacheCapacity",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "name": "query - 0"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Hive"
              },
              {
                "parameterName": "hive_usage",
                "comparison": "isEqualTo",
                "value": "present"
              }
            ],
            "name": "Hive "
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "HDInsightSparkApplicationEvents\r\n| where ClusterName in ({Clusters})\r\n| summarize SubmittedApps = dcount(ApplicationId), CompletedApps=countif(isnotempty(CompletionTime)) by ClusterDnsName\r\n| join (HDInsightHadoopAndYarnMetrics\r\n| where MetricNamespace != \"Hadoop:service=NodeManager,name=NodeManagerMetrics\"  and (MetricName == \"AllocatedVCores\" or MetricName == \"AllocatedMB\" or  MetricName == \"AppsFailed\")\r\n| summarize arg_max(TimeGenerated, *) by ClusterName, MetricNamespace, MetricName\r\n| evaluate pivot (MetricName, sum(MetricValue), ClusterName))\r\non $left.ClusterDnsName == $right.ClusterName\r\n| extend SubmittedApps = iff(isempty(SubmittedApps), 0, tolong(SubmittedApps))\r\n| extend CompletedApps = iff(isempty(CompletedApps), 0, tolong(CompletedApps))\r\n| project ClusterName, SubmittedApps, CompletedApps, FailedApps=AppsFailed, AllocatedVCores, AllocatedMB",
                    "size": 0,
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AllocatedMB",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 4,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 4"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Spark"
              },
              {
                "parameterName": "spark_usage",
                "comparison": "isEqualTo",
                "value": "present"
              }
            ],
            "name": "Spark"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "No logs and metrics were detected in the selected workspaces. Please make sure you have at least one cluster with the Azure Monitor Integration enabled. ",
                    "style": "warning"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "overview_usage",
                "comparison": "isEqualTo",
                "value": "not present"
              },
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Overview"
              }
            ],
            "name": "No Overview Logs"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "No Kafka metrics were detected in the selected workspaces. Please make sure you have the Azure Monitor Integration turned on for at least one Kafka cluster.",
                    "style": "warning"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "kafka_usage",
                "comparison": "isEqualTo",
                "value": "not present"
              },
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Kafka"
              }
            ],
            "name": "No Kafka Usage"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "No HBase metrics were detected in the selected workspaces. Please make sure you have the Azure Monitor Integration turned on for at least one HBase cluster.",
                    "style": "warning"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "hbase_usage",
                "comparison": "isEqualTo",
                "value": "not present"
              },
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "HBase"
              }
            ],
            "name": "NoHBase Usage"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "No Hive metrics were detected in the selected workspaces. Please make sure you have the Azure Monitor Integration turned on for at least one Hive cluster.",
                    "style": "warning"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "hive_usage",
                "comparison": "isEqualTo",
                "value": "not present"
              },
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Hive"
              }
            ],
            "name": "No  Hive Usage"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "No Storm metrics were detected in the selected workspaces. Please make sure you have the Azure Monitor Integration turned on for at least one Storm cluster.",
                    "style": "warning"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "storm_usage",
                "comparison": "isEqualTo",
                "value": "not present"
              },
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Storm"
              }
            ],
            "name": "No  Storm Usage"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "No Spark metrics were detected in the selected workspaces. Please make sure you have the Azure Monitor Integration turned on for at least one Spark cluster and applications have run within the selected time range. If no applications have been run in the selected time range, there will be no metrics in the tab.",
                    "style": "warning"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "spark_usage",
                "comparison": "isEqualTo",
                "value": "not present"
              },
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Spark"
              }
            ],
            "name": "No Spark Usage"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "No Yarn metrics were detected in the selected workspaces. Please make sure you have the Azure Monitor Integration turned on for at least one cluster that uses Yarn (hbase, hadoop, hive, spark).",
                    "style": "warning"
                  },
                  "name": "text - 0"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "yarn_usage",
                "comparison": "isEqualTo",
                "value": "not present"
              },
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "YARN"
              }
            ],
            "name": "No Yarn"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "monitor_tab",
        "comparison": "isEqualTo",
        "value": "Monitored"
      },
      "name": "MonitoredClusters"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "HDInsightAmbariSystemMetrics\r\n| distinct ClusterName\r\n",
              "size": 0,
              "timeContext": {
                "durationMs": 300000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{LogAnalyticsWorkspaces}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "DiskPercentUsed",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "CPUUsagePercentage",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "FreeMemoryBytes",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "monitor_tab",
              "comparison": "isEqualTo"
            },
            "name": "ClusterMetrics"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "where type =~ 'microsoft.hdinsight/clusters' | project  name, id",
              "size": 0,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ]
            },
            "conditionalVisibility": {
              "parameterName": "monitor_tab",
              "comparison": "isEqualTo"
            },
            "name": "ClusterResourceInfo"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"31e32675-efbd-41ae-878e-349f2d2922ec\",\"mergeType\":\"rightanti\",\"leftTable\":\"ClusterMetrics\",\"rightTable\":\"ClusterResourceInfo\",\"leftColumn\":\"ClusterName\",\"rightColumn\":\"name\"}],\"projectRename\":[{\"originalName\":\"[ClusterResourceInfo].name\",\"mergedName\":\"name\",\"fromId\":\"31e32675-efbd-41ae-878e-349f2d2922ec\"},{\"originalName\":\"[ClusterResourceInfo].id\",\"mergedName\":\"Enable Monitoring Link\",\"fromId\":\"31e32675-efbd-41ae-878e-349f2d2922ec\"}]}",
              "size": 0,
              "queryType": 7,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Enable Monitoring Link",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "subTarget": "azuremonitor",
                      "linkLabel": "Enable Monitoring Here",
                      "linkIsContextBlade": false,
                      "showIcon": false,
                      "bladeOpenContext": {
                        "bladeParameters": []
                      }
                    }
                  }
                ]
              }
            },
            "showPin": false,
            "name": "query - 2"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "monitor_tab",
        "comparison": "isEqualTo",
        "value": "Unmonitored"
      },
      "name": "UnmonitoredClusters"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}