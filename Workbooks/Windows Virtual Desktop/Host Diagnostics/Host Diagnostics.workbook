{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "b859a03f-2283-43dd-8536-42714bbfced6",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "query": "summarize Count = count() by subscriptionId\r\n| project value = strcat('/subscriptions/', subscriptionId), label = subscriptionId, Selected = Count >= 0",
            "crossComponentResources": [
              "value::selected"
            ],
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "2e3dfd9b-2d0f-4feb-94e8-107f220c4e28",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "type": 5,
            "isRequired": true,
            "query": "resources\r\n| where type contains  \"desktopvirtualization\"\r\n| summarize Count = count() by resourceGroup\r\n| project Label = resourceGroup, Id = resourceGroup, Selected = Count >= 0",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "951b5870-e216-45c6-b159-34150868a46e",
            "version": "KqlParameterItem/1.0",
            "name": "HostPool",
            "type": 5,
            "isRequired": true,
            "query": "resources\r\n| where type == \"microsoft.desktopvirtualization/hostpools\" and resourceGroup == \"{ResourceGroup}\"\r\n",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "966a75f4-f4a4-4404-b649-67da45ddf636",
            "version": "KqlParameterItem/1.0",
            "name": "WVDHosts",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{ResourceGroup}/providers/Microsoft.DesktopVirtualization/hostpools/{HostPool:label}/sessionhosts?api-version=2019-01-23-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"Name\"}]}}]}",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ]
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 12,
            "value": [
              "value::all"
            ]
          },
          {
            "id": "04a8ead2-1fb2-4666-a7b0-6d92e3c29b46",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "value": {
              "durationMs": 172800000
            }
          },
          {
            "id": "ff8c2838-aaf0-40f6-a604-d4bfe72fc92f",
            "version": "KqlParameterItem/1.0",
            "name": "poolla",
            "type": 5,
            "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/{HostPool}/providers/microsoft.insights/diagnosticSettings?api-version=2017-05-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.workspaceId\",\"columnid\":\"id\"},{\"path\":\"$.id\",\"columnid\":\"selected\"}]}}]}",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 12
          },
          {
            "id": "08f46c2a-f080-40c5-b36f-acd0e80c6259",
            "version": "KqlParameterItem/1.0",
            "name": "WorkspaceId",
            "type": 1,
            "query": "resources\r\n| where type =~ \"Microsoft.Compute/virtualMachines/extensions\"and properties.type == \"MicrosoftMonitoringAgent\"\r\n| where id contains extract(\"/(.*?)[.]\",1,\"{WVDHosts}\")\r\n| project Value = parse_json(properties.settings).workspaceId, selected=true\r\n| limit 1",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "29c8282b-4c11-409c-b4e9-1049edbaf67a",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "query": "resources\r\n| where type == \"microsoft.operationalinsights/workspaces\"\r\n| where properties.customerId == \"{WorkspaceId}\"",
            "crossComponentResources": [
                "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "6c8ec0d1-d1e2-4324-8b1d-e01e3c53d789",
            "version": "KqlParameterItem/1.0",
            "name": "hostnames",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\ndatatable (hosts:dynamic)[dynamic([{WVDHosts}])]\r\n| mv-expand hosts\r\n| project hosts=split(hosts,\"/\")[1]\r\n| project hosts=split(hosts,\".\")[0], selected=1\r\n",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "Parameters"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Host Diagnostics"
            },
            "name": "text - 0"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "b25ad595-1722-4ed6-ab15-17d45003785d",
                  "version": "KqlParameterItem/1.0",
                  "name": "showall",
                  "label": "Show All Computers",
                  "type": 10,
                  "isRequired": true,
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\" | where 1==1 \", \"label\":\"yes\", \"selected\":false },\r\n{\"value\":\"| extend Computername = strcat(hostPool, '/', Computer)| where Computername in (WVDHosts)\", \"label\":\"no\" , \"selected\":true }]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 9"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Session Host Details",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.desktopvirtualization/hostpools\"\r\n| where resourceGroup == '{ResourceGroup:label}' and name == '{HostPool:label}'\r\n| extend details = parse_json(properties)\r\n| project resourceGroup, HostPool = name, location, LoadBalanceType = tostring(details.loadBalancerType), MaxSessionLimit = toint(details.maxSessionLimit) , HostPoolType = tostring(details.hostPoolType)",
                    "size": 4,
                    "title": "Hostpool specifics",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "TEST",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "hostpoolspecifics"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nHeartbeat\r\n| extend HostPool = '{HostPool:label}'\r\n| extend FullName = strcat(\"{HostPool:label}\", \"/\", Computer)\r\n| where FullName in (WVDHosts)\r\n| summarize (TimeGenerated, FullName, HostPool)=argmax(TimeGenerated, FullName, HostPool = HostPool) by Computer\r\n//| join kind=leftouter \r\n//(\r\n//    Perf\r\n//    | extend FullName = strcat(\"{HostPool:label}\", \"/\", Computer)\r\n//    | where FullName in (WVDHosts)\r\n//    | make-series TSActTrend = avgif(CounterValue, ObjectName == \"Terminal Services\" and CounterName == \"Active Sessions\") default=0,\r\n//                MemTrend = avgif(CounterValue, ObjectName == \"Memory\" and CounterName == \"% Committed Bytes In Use\") default=0,\r\n//                CPUTrend = avgif(CounterValue, ObjectName == \"Processor\" and CounterName == \"% Processor Time\") default=0 \r\n//        on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Computer\r\n//    | project TSActTrend, MemTrend, CPUTrend, Computer\r\n//) on Computer\r\n| extend ShortName = trim_end(@'\\..*', Computer)\r\n| project Computer, FullName, ShortName, HostPool //, TSActTrend, MemTrend, CPUTrend\r\n",
                    "size": 4,
                    "title": "HostTrend",
                    "timeContext": {
                      "durationMs": 172800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Computer",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "FullName",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "HostPool",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "TSActTrend",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "MemTrend",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "CPUTrend",
                          "formatter": 5,
                          "formatOptions": {}
                        }
                      ]
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Computer",
                        "formatter": 1
                      },
                      "showBorder": false,
                      "size": "auto"
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "TEST",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "hostperf_prep1",
                  "styleSettings": {
                    "margin": "1px",
                    "padding": "1px"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{ResourceGroup}/providers/Microsoft.DesktopVirtualization/hostpools/{HostPool:label}/sessionhosts?api-version=2019-01-23-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.status\",\"columnid\":\"Status\"},{\"path\":\"$.name\",\"columnid\":\"Name\"},{\"path\":\"$.properties.lastHeartBeat\",\"columnid\":\"LastHeartbeat\"},{\"path\":\"$.properties.sessions\",\"columnid\":\"Sessions\"},{\"path\":\"$.properties.allowNewSession\",\"columnid\":\"AllowNewSessions\"},{\"path\":\"$.properties.sxSStackVersion\",\"columnid\":\"StackVersion\"},{\"path\":\"$\",\"columnid\":\"\"}]}}]}",
                    "size": 1,
                    "title": "Sessions per Host",
                    "queryType": 12,
                    "visualization": "table",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name",
                        "formatter": 1
                      },
                      "subtitleContent": {
                        "columnMatch": "Status"
                      },
                      "leftContent": {
                        "columnMatch": "Sessions",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false,
                      "size": "auto"
                    }
                  },
                  "customWidth": "100",
                  "conditionalVisibility": {
                    "parameterName": "TEST",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "hostperf_prep2",
                  "styleSettings": {
                    "margin": "1px",
                    "padding": "1px",
                    "progressStyle": "none"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nWVDConnections\r\n| where State == \"Started\" and TimeGenerated > ago(1d)\r\n| extend Computername = strcat(\"{HostPool:label}\",\"/\", SessionHostName)\r\n| where Computername in (WVDHosts)\r\n| summarize Users = dcount(UserName) by Computername, SessionHostName\r\n| extend ShortName = trim_end(@'\\..*', SessionHostName)\r\n",
                    "size": 1,
                    "title": "Host users in 24h",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                        "{poolla}"
                    ],
                    "visualization": "table"
                  },
                  "conditionalVisibility": {
                    "parameterName": "TEST",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "HostUsers"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines'\r\n| extend VMSKU = properties.hardwareProfile.vmSize\r\n| project id, ShortName = name, VMSKU, resourceGroup, location\r\n",
                    "size": 0,
                    "title": "Compute info",
                    "noDataMessage": "No WVD resources detected. Please select the subscription that contains your WVD resources",
                    "noDataMessageStyle": 4,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "table",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "VMSKU",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "HostCount",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "100",
                  "conditionalVisibility": {
                    "parameterName": "TEST",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "showPin": true,
                  "name": "VMSkus",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"eb82698f-2418-4770-8607-a730f61540f9\",\"mergeType\":\"innerunique\",\"leftTable\":\"hostperf_prep1\",\"rightTable\":\"hostperf_prep2\",\"leftColumn\":\"FullName\",\"rightColumn\":\"Name\"},{\"id\":\"4442370c-c5d7-4c71-bd44-38fa00d42175\",\"mergeType\":\"leftouter\",\"leftTable\":\"hostperf_prep1\",\"rightTable\":\"HostUsers\",\"leftColumn\":\"ShortName\",\"rightColumn\":\"ShortName\"},{\"id\":\"4442370c-c5d7-4c71-bd44-38fa00d42177\",\"mergeType\":\"innerunique\",\"leftTable\":\"hostperf_prep1\",\"rightTable\":\"VMSkus\",\"leftColumn\":\"ShortName\",\"rightColumn\":\"ShortName\"},{\"id\":\"b2f24c93-335c-4bd7-b7f8-a345ba67b151\",\"mergeType\":\"leftouter\",\"leftTable\":\"hostperf_prep1\",\"rightTable\":\"hostpoolspecifics\",\"leftColumn\":\"HostPool\",\"rightColumn\":\"HostPool\"}],\"projectRename\":[{\"originalName\":\"[VMSkus].id\",\"mergedName\":\"SessionHost\",\"fromId\":\"unknown\"},{\"originalName\":\"[hostperf_prep1].Computer\",\"mergedName\":\"Computer\",\"fromId\":\"eb82698f-2418-4770-8607-a730f61540f9\"},{\"originalName\":\"[hostperf_prep1].FullName\",\"mergedName\":\"FullName\",\"fromId\":\"eb82698f-2418-4770-8607-a730f61540f9\"},{\"originalName\":\"[hostperf_prep1].ShortName\",\"mergedName\":\"ShortName\",\"fromId\":\"unknown\"},{\"originalName\":\"[hostperf_prep1].HostPool\",\"mergedName\":\"HostPool\",\"fromId\":\"eb82698f-2418-4770-8607-a730f61540f9\"},{\"originalName\":\"[hostperf_prep2].LastHeartbeat\",\"mergedName\":\"LastHeartbeat\",\"fromId\":\"eb82698f-2418-4770-8607-a730f61540f9\"},{\"originalName\":\"[hostperf_prep2].Status\",\"mergedName\":\"Status\",\"fromId\":\"eb82698f-2418-4770-8607-a730f61540f9\"},{\"originalName\":\"[hostperf_prep2].Name\",\"mergedName\":\"Name\",\"fromId\":\"eb82698f-2418-4770-8607-a730f61540f9\"},{\"originalName\":\"[hostperf_prep2].AllowNewSessions\",\"mergedName\":\"New sessions\",\"fromId\":\"unknown\"},{\"originalName\":\"[hostperf_prep2].Sessions\",\"mergedName\":\"Sessions\",\"fromId\":\"eb82698f-2418-4770-8607-a730f61540f9\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"AvailableSessions\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Sessions\",\"operator\":\">\",\"rightValType\":\"static\",\"rightVal\":\"0\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"MaxSessionLimit\\\"] - [\\\"Sessions\\\"]\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[HostUsers].Users\",\"mergedName\":\"24h Users\",\"fromId\":\"4442370c-c5d7-4c71-bd44-38fa00d42175\"},{\"originalName\":\"[VMSkus].VMSKU\",\"mergedName\":\"VMSKU\",\"fromId\":\"4442370c-c5d7-4c71-bd44-38fa00d42177\"},{\"originalName\":\"[VMSkus].resourceGroup\",\"mergedName\":\"Resource Group\",\"fromId\":\"4442370c-c5d7-4c71-bd44-38fa00d42177\"},{\"originalName\":\"[VMSkus].location\",\"mergedName\":\"Location\",\"fromId\":\"4442370c-c5d7-4c71-bd44-38fa00d42177\"},{\"originalName\":\"[HostUsers].Computername\",\"mergedName\":\"Computername\",\"fromId\":\"4442370c-c5d7-4c71-bd44-38fa00d42175\"},{\"originalName\":\"[HostUsers].ShortName\",\"mergedName\":\"ShortName1\",\"fromId\":\"4442370c-c5d7-4c71-bd44-38fa00d42175\"},{\"originalName\":\"[VMSkus].ShortName\",\"mergedName\":\"ShortName2\",\"fromId\":\"4442370c-c5d7-4c71-bd44-38fa00d42177\"},{\"originalName\":\"[hostperf_prep2].StackVersion\",\"mergedName\":\"Stack version\",\"fromId\":\"unknown\"},{\"originalName\":\"[hostpoolspecifics].resourceGroup\",\"mergedName\":\"resourceGroup1\",\"fromId\":\"b2f24c93-335c-4bd7-b7f8-a345ba67b151\"},{\"originalName\":\"[hostpoolspecifics].HostPool\",\"mergedName\":\"HostPool1\",\"fromId\":\"b2f24c93-335c-4bd7-b7f8-a345ba67b151\"},{\"originalName\":\"[hostpoolspecifics].location\",\"mergedName\":\"location1\",\"fromId\":\"b2f24c93-335c-4bd7-b7f8-a345ba67b151\"},{\"originalName\":\"[hostpoolspecifics].LoadBalanceType\",\"mergedName\":\"LoadBalanceType\",\"fromId\":\"b2f24c93-335c-4bd7-b7f8-a345ba67b151\"},{\"originalName\":\"[hostpoolspecifics].MaxSessionLimit\",\"mergedName\":\"MaxSessionLimit\",\"fromId\":\"b2f24c93-335c-4bd7-b7f8-a345ba67b151\"},{\"originalName\":\"[hostpoolspecifics].HostPoolType\",\"mergedName\":\"HostPoolType\",\"fromId\":\"b2f24c93-335c-4bd7-b7f8-a345ba67b151\"},{\"originalName\":\"[HostUsers].SessionHostName\"},{\"originalName\":\"[hostperf_prep2].$\"}]}",
                    "size": 1,
                    "exportedParameters": [
                      {
                        "fieldName": "Computer",
                        "parameterName": "SelectedComputer"
                      },
                      {
                        "fieldName": "Sessions",
                        "parameterName": "SelectedSessions",
                        "parameterType": 1,
                        "defaultValue": "0"
                      }
                    ],
                    "queryType": 7,
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "SessionHost",
                          "formatter": 0,
                          "formatOptions": {
                            "aggregation": "Count"
                          }
                        },
                        {
                          "columnMatch": "Computer",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "FullName",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "HostPool",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Unavailable",
                                "representation": "Unavailable",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Available",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Shutdown",
                                "representation": "stopped",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "unknown",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "New sessions",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "Available",
                                "text": "Allowed"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "disabled",
                                "text": "Drain"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Sessions",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue",
                            "aggregation": "Sum"
                          }
                        },
                        {
                          "columnMatch": "24h Users",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue",
                            "aggregation": "Sum"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            },
                            "emptyValCustomText": "0"
                          }
                        },
                        {
                          "columnMatch": "VMSKU",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Resource Group",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Location",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Stack version",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 5,
                          "formatOptions": {
                            "linkTarget": "Resource"
                          }
                        },
                        {
                          "columnMatch": "location1",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "LoadBalanceType",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "MaxSessionLimit",
                          "formatter": 5,
                          "formatOptions": {
                            "aggregation": "Sum"
                          }
                        },
                        {
                          "columnMatch": "Last Update",
                          "formatter": 6,
                          "formatOptions": {
                            "aggregation": "Max",
                            "customColumnWidthSetting": "27ch"
                          }
                        },
                        {
                          "columnMatch": "LoadBalancerType",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "PreferredAppGroupType",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "NWRTrend",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "NWSTrend",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "SessionHost"
                        },
                        {
                          "columnId": "Computer"
                        },
                        {
                          "columnId": "FullName"
                        },
                        {
                          "columnId": "ShortName",
                          "label": "Host Name"
                        },
                        {
                          "columnId": "HostPool"
                        },
                        {
                          "columnId": "LastHeartbeat",
                          "label": "Last Update"
                        },
                        {
                          "columnId": "Status"
                        },
                        {
                          "columnId": "Name"
                        },
                        {
                          "columnId": "New sessions"
                        },
                        {
                          "columnId": "Sessions"
                        },
                        {
                          "columnId": "AvailableSessions",
                          "label": "Available Sessions"
                        },
                        {
                          "columnId": "24h Users"
                        },
                        {
                          "columnId": "VMSKU"
                        },
                        {
                          "columnId": "Resource Group"
                        },
                        {
                          "columnId": "Location"
                        },
                        {
                          "columnId": "Computername"
                        },
                        {
                          "columnId": "ShortName1"
                        },
                        {
                          "columnId": "ShortName2"
                        },
                        {
                          "columnId": "Stack version"
                        },
                        {
                          "columnId": "resourceGroup1"
                        },
                        {
                          "columnId": "HostPool1"
                        },
                        {
                          "columnId": "location1"
                        },
                        {
                          "columnId": "LoadBalanceType"
                        },
                        {
                          "columnId": "MaxSessionLimit"
                        },
                        {
                          "columnId": "HostPoolType"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "showPin": false,
                  "name": "hostandperfmerge"
                }
              ]
            },
            "name": "group - 0",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Performance Counters",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "parameters": [
                      {
                        "id": "c3cfc2ba-dcc6-43ba-9988-f972f0bdfd24",
                        "version": "KqlParameterItem/1.0",
                        "name": "CPUThreshold",
                        "label": "CPU Threshold%",
                        "type": 1,
                        "value": "60",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "c3cfc2ba-dcc6-43ba-9988-f972f0bdfd24",
                        "version": "KqlParameterItem/1.0",
                        "name": "FreeDiskSpace",
                        "label": "Free Disk Space",
                        "type": 1,
                        "value": "20",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "c3cfc2ba-dcc6-43ba-9988-f972f0bdfd24",
                        "version": "KqlParameterItem/1.0",
                        "name": "InputDelay",
                        "label": "Input Delay",
                        "type": 1,
                        "value": "500",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "c3cfc2ba-dcc6-43ba-9988-f972f0bdfd24",
                        "version": "KqlParameterItem/1.0",
                        "name": "AvailableMBytes",
                        "label": "Available MBytes",
                        "type": 1,
                        "value": "2000",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "00a44e6b-a872-4ffe-b3a6-addf716f852c",
                        "version": "KqlParameterItem/1.0",
                        "name": "PageFaultssec",
                        "label": "Page Faults/sec",
                        "type": 1,
                        "value": "10000"
                      },
                      {
                        "id": "bc19009c-e60f-4d4b-adf1-2312e5449045",
                        "version": "KqlParameterItem/1.0",
                        "name": "numberofvms",
                        "type": 1,
                        "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| distinct Computer\r\n| summarize count()",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "2f779c70-a4af-4e80-8445-23f73e363ebf",
                        "version": "KqlParameterItem/1.0",
                        "name": "Period",
                        "label": "Threshold Duration(min)",
                        "type": 1,
                        "description": "This the time the performance value needs to hit the threshold for it to be flagged.",
                        "value": "5"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 17"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nlet GetPerfSummary = (object:string, countername:string, instance:string, name:string, threshold:real, gt:bool)\r\n{\r\nlet myfilter = repeat(1,{Period});\r\nlet TotalTime = tolong(\r\ntoscalar(\r\n  Perf\r\n    | where TimeGenerated {TimeRange:query}\r\n    {showall}\r\n    | where ObjectName == object and CounterName == countername and (isempty(instance) or InstanceName=~  instance)\r\n    | project TimeGenerated\r\n    | summarize period = ((max(TimeGenerated)-min(TimeGenerated))/1s)\r\n)\r\n);\r\nPerf\r\n    | where TimeGenerated {TimeRange:query}\r\n    {showall}\r\n    | where ObjectName == object and CounterName == countername and (isempty(instance) or InstanceName=~  instance)\r\n    //| project Computer, TimeGenerated, hittsh = iif(iff(gt,CounterValue > threshold, CounterValue < threshold),1,0) \r\n    //| summarize t=make_list(  TimeGenerated), val= make_list( hittsh), Total=count()  by Computer\r\n    | make-series val=iff(iff(gt,avg(CounterValue) > threshold, avg(CounterValue) < threshold),1,0)  on TimeGenerated step 1m by Computer\r\n    //| make-series val=avg(CounterValue) on TimeGenerated step 1m by Computer\r\n    | extend MovingAvg=series_fir(val, myfilter, true)\r\n    | project Computer, TimeGenerated, MovingAvg\r\n    | mv-expand  TimeGenerated, MovingAvg\r\n    | extend val= iif(round(todouble(MovingAvg),1) ==1, 1, 0)\r\n    | where val==1\r\n    | summarize Machine=dcount(Computer)\r\n| extend Instance=instance, Name=name, ObjectName=object, CounterName=countername, GT=gt, Threshold=threshold\r\n};\r\nGetPerfSummary(\"Processor Information\", \"% Processor Time\", \"\" ,\"CPU Utilization\" ,{CPUThreshold}, true)\r\n| union GetPerfSummary(\"LogicalDisk\", \"% Free Space\",  \"\", \"C: Disk Space\" , {FreeDiskSpace}, false)\r\n| union GetPerfSummary(\"Memory\", \"Available MBytes\",  \"\", \"Available MBytes\" , {AvailableMBytes}, false)\r\n| union GetPerfSummary(\"Memory\", \"Page Faults/sec\",  \"\", \"Page Faults/sec\" , {PageFaultssec}, true)\r\n| union GetPerfSummary(\"User Input Delay per Session\", \"Max Input Delay\",  \"Max\", \"Input Delay per Session\" , {InputDelay}, true)\r\n| extend Subtitle=\"Hosts\"\r\n//| summarize val=max(val) by bin(todatetime(TimeGenerated), {TimeRange:grain}), Computer, Name\r\n//| summarize Issues=sum(val) by TimeGenerated, Name\r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "exportedParameters": [
                      {
                        "fieldName": "ObjectName",
                        "parameterName": "ObjectName",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "Instance",
                        "parameterName": "Instance",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "CounterName",
                        "parameterName": "CounterName",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "GT",
                        "parameterName": "GT",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "Threshold",
                        "parameterName": "Threshold",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "Name",
                        "parameterName": "PerfName",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name",
                        "formatter": 1
                      },
                      "subtitleContent": {
                        "columnMatch": "Subtitle"
                      },
                      "leftContent": {
                        "columnMatch": "Machine",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 0,
                          "max": 1,
                          "palette": "greenRed"
                        },
                        "tooltipFormat": {
                          "tooltip": "Number of session hosts"
                        }
                      },
                      "rightContent": {
                        "columnMatch": "Value",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 0,
                          "max": 100,
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumFractionDigits": 1,
                            "maximumFractionDigits": 1
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "Percentage of  thresholds was hit dusing the tiime window"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "name": "query - 16"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nlet GetPerfSummary = (object:string, countername:string, instance:string, threshold:real, gt:bool)\r\n{\r\nlet myfilter = repeat(1,{Period});\r\nlet TotalTime = tolong(toscalar(\r\nPerf\r\n    | where TimeGenerated {TimeRange:query}\r\n    {showall}\r\n    | where ObjectName == object and CounterName == countername and (isempty(instance) or InstanceName=~  instance)\r\n    | project TimeGenerated\r\n    | summarize period = (max(TimeGenerated)-min(TimeGenerated))/1s\r\n    ));\r\nPerf\r\n    | where TimeGenerated {TimeRange:query}\r\n    {showall}\r\n    | where ObjectName == object and CounterName == countername and (isempty(instance) or InstanceName=~  instance)\r\n    | make-series val=iff(iff(gt,avg(CounterValue) > threshold, avg(CounterValue) < threshold),1,0)  on TimeGenerated step 1m by Computer, _ResourceId\r\n    | extend MovingAvg=series_fir(val, myfilter, true), Total= array_length(TimeGenerated)\r\n    | project Computer, _ResourceId, TimeGenerated, MovingAvg, Total\r\n    | mv-expand  TimeGenerated, MovingAvg\r\n    | extend val= iif(round(todouble(MovingAvg),1) ==1, 1, 0)\r\n    | where val==1\r\n    //    | summarize Machine=dcount(Computer)\r\n    | summarize Start=min(todatetime(TimeGenerated)), End=max(todatetime(TimeGenerated)), Average=avg(todouble(val)),P95th=percentile(todouble(val),95), TimePercent = 100*count()/todouble(max(Total)) by Computer, _ResourceId\r\n};\r\nGetPerfSummary(\"{ObjectName}\", \"{CounterName}\" , \"{Instance}\" ,{Threshold}, {GT})\r\n\r\n\r\n",
                          "size": 0,
                          "exportedParameters": [
                            {
                              "fieldName": "Computer",
                              "parameterName": "SelectedComputer",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "Computer",
                              "parameterName": "Computer",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "Start",
                              "parameterName": "TimeStart",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "End",
                              "parameterName": "TimeEnd",
                              "parameterType": 1
                            }
                          ],
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 5,
                                "formatOptions": {
                                  "customColumnWidthSetting": "40.2857ch"
                                }
                              },
                              {
                                "columnMatch": "Start",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20.8571ch"
                                }
                              },
                              {
                                "columnMatch": "End",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22ch"
                                }
                              },
                              {
                                "columnMatch": "Average",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "greenRed",
                                  "compositeBarSettings": {
                                    "labelText": "",
                                    "columnSettings": [
                                      {
                                        "columnName": "Average",
                                        "color": "blue"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "89px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "P95th",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "greenRed",
                                  "customColumnWidthSetting": "78px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "TimePercent",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "blue",
                                  "customColumnWidthSetting": "78px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "P50th",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 1,
                                  "max": 1,
                                  "palette": "blue"
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "sortBy": [
                              {
                                "itemKey": "Computer",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Computer"
                              },
                              {
                                "columnId": "_ResourceId",
                                "label": "Host"
                              },
                              {
                                "columnId": "Start"
                              },
                              {
                                "columnId": "End"
                              },
                              {
                                "columnId": "Average"
                              },
                              {
                                "columnId": "P95th"
                              },
                              {
                                "columnId": "TimePercent",
                                "label": "Time %"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "Computer",
                              "sortOrder": 1
                            }
                          ],
                          "chartSettings": {
                            "xAxis": "TimeGenerated",
                            "yAxis": [
                              "Average"
                            ],
                            "group": "Computer",
                            "createOtherGroup": null,
                            "showMetrics": false,
                            "showLegend": true
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 19"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let GetPerfSummary = (object:string, countername:string, instance:string, threshold:real, gt:bool)\r\n{\r\nlet start = todatetime(\"{TimeStart}\");\r\nlet end = todatetime(\"{TimeEnd}\");\r\nlet totalmins=(end-start)/1m;\r\nlet rangeAdd = iff(totalmins < 5, 5m, 0m);//(end-start)/10;\r\nlet grain = 1m;// (end-start)/1000;\r\nPerf \r\n| where TimeGenerated >= (start-rangeAdd) and TimeGenerated <= (end+rangeAdd) \r\n//| where TimeGenerated {TimeRange:query}\r\n| where ObjectName == object and CounterName == countername and (isempty(instance) or InstanceName=~\r\ninstance) and Computer == \"{SelectedComputer}\"\r\n| project TimeGenerated, CounterValue\r\n| make-series Val=avg(CounterValue) on TimeGenerated step totimespan(1m)\r\n| extend threshold = repeat({Threshold},array_length(Val))\r\n};\r\nGetPerfSummary(\"{ObjectName}\", \"{CounterName}\" , \"{Instance}\" ,{CPUThreshold}, true)\r\n| render timechart\r\n\r\n",
                          "size": 0,
                          "title": "{SelectedComputer} - {PerfName}",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "timechart",
                          "gridSettings": {
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Computer"
                              ]
                            }
                          },
                          "chartSettings": {
                            "ySettings": {
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "SelectedComputer",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "query - 19 - Copy"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "ObjectName",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "PerfDrillDown"
                }
              ]
            },
            "name": "PerfGroup",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Events",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nEvent\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where Source == \"Microsoft-FSLogix-Apps\" and EventLevel < 4\r\n| summarize Value=count(), Machines = dcount(Computer)\r\n| extend Name=\"FSLogix Warnings and Errors\", Help = \"https://github.com/mpbastos/nmdoc/blob/master/docs/hostdiag.md#fslogix-fail-to-start\", level=5\r\n| union (Event\r\n| where TimeGenerated {TimeRange:query}\r\n{showall} \r\n| where Source == \"Service Control Manager\"\r\n| where EventID == 7000\r\n| extend param = parse_xml(EventData).DataItem.EventData.Data[0][\"#text\"]\r\n| where param == \"frxsvc\"\r\n| summarize Value=count(), Machines = dcount(Computer)\r\n| extend Name=\"FSLogix Fail to Start\", Help = \"https://github.com/mpbastos/nmdoc/blob/master/docs/hostdiag.md#fslogix-fail-to-start\", level=1)\r\n| union (Event\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n      | where EventLog == \"System\"\r\n      | where (EventID == 41 and Source  == \"Microsoft-Windows-Kernel-Power\") or (Source == \"Microsoft-Windows-WER-SystemErrorReporting\" and EventID ==1001)\r\n      | summarize Value=count(), Machines = dcount(Computer)\r\n      | extend Name=\"Unexpected Reboots\", Help = \"https://github.com/mpbastos/nmdoc/blob/master/docs/hostdiag.md#unexpected-reboots\", level=0)\r\n| union (Event\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where Source == \"Microsoft-Windows-Winlogon\"\r\n| where  EventID == 6005\r\n| extend Parameters = parse_xml(EventData).DataItem.EventData.Data[0]\r\n| where Parameters == \"frxsvc\"\r\n| summarize Value=count(), Machines = dcount(Computer)\r\n| extend Name=\"Fslogix logon timeout\", Help = \"https://github.com/mpbastos/nmdoc/blob/master/docs/hostdiag.md#fslogix-logon-timeout\", level=1)\r\n| extend Subtitle=\"Hosts/Instances\"\r\n| order by Machines desc ,level asc\r\n\r\n\r\n\r\n\r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "exportFieldName": "Name",
                    "exportParameterName": "EventDrill",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name",
                        "formatter": 1
                      },
                      "subtitleContent": {
                        "columnMatch": "Subtitle"
                      },
                      "leftContent": {
                        "columnMatch": "Machines",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 0,
                          "max": 1,
                          "palette": "greenRed"
                        },
                        "tooltipFormat": {
                          "tooltip": "Number of session hosts"
                        }
                      },
                      "rightContent": {
                        "columnMatch": "Value",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "tooltipFormat": {
                          "tooltip": "Number of instances"
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Help",
                        "formatter": 7,
                        "formatOptions": {
                          "linkTarget": "Url",
                          "linkLabel": "Help",
                          "linkIsContextBlade": false
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "name": "EventsSummary"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nEvent\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where Source == \"Microsoft-FSLogix-Apps\" and EventLevel < 4\r\n| project _ResourceId, TimeGenerated, EventID, EventLevelName, RenderedDescription",
                          "size": 1,
                          "noDataMessage": "No Events",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "EventDrill",
                          "comparison": "isEqualTo",
                          "value": "FSLogix Warnings and Errors"
                        },
                        "name": "FSLogixWarnigsDrillDown"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nEvent\r\n| where TimeGenerated {TimeRange:query}\r\n{showall} \r\n| where Source == \"Service Control Manager\"\r\n| where EventID == 7000\r\n| extend param = parse_xml(EventData).DataItem.EventData.Data[0][\"#text\"]\r\n| where param == \"frxsvc\"\r\n| project _ResourceId,  TimeGenerated, EventID, EventLevelName, RenderedDescription",
                          "size": 1,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "EventDrill",
                          "comparison": "isEqualTo",
                          "value": "FSLogix Fail to Start"
                        },
                        "name": "FSLFailToStartDrillDown"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nEvent\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n      | where EventLog == \"System\"\r\n      | where (EventID == 41 and Source  == \"Microsoft-Windows-Kernel-Power\") or (Source == \"Microsoft-Windows-WER-SystemErrorReporting\" and EventID ==1001)\r\n      | project _ResourceId, TimeGenerated, EventID, EventLevelName, RenderedDescription",
                          "size": 1,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "_ResourceId",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "21.8571ch"
                                }
                              },
                              {
                                "columnMatch": "TimeGenerated",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "23.2857ch"
                                }
                              },
                              {
                                "columnMatch": "EventID",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "13ch"
                                }
                              },
                              {
                                "columnMatch": "EventLevelName",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "RenderedDescription",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "GenericDetails",
                                  "linkIsContextBlade": true,
                                  "customColumnWidthSetting": "85.1429ch"
                                }
                              }
                            ]
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "EventDrill",
                          "comparison": "isEqualTo",
                          "value": "Unexpected Reboots"
                        },
                        "showPin": false,
                        "name": "RobootDrillDown"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nEvent\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where Source == \"Microsoft-Windows-Winlogon\"\r\n| where  EventID == 6005\r\n| extend Parameters = parse_xml(EventData).DataItem.EventData.Data[0]\r\n| where Parameters == \"frxsvc\"\r\n| project _ResourceId, TimeGenerated, EventID, EventLevelName, RenderedDescription\r\n",
                          "size": 1,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "_ResourceId",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "TimeGenerated",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.2857ch"
                                }
                              },
                              {
                                "columnMatch": "EventID",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "12.1429ch"
                                }
                              },
                              {
                                "columnMatch": "EventLevelName",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "19.1429ch"
                                }
                              },
                              {
                                "columnMatch": "RenderedDescription",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "GenericDetails",
                                  "linkIsContextBlade": true,
                                  "customColumnWidthSetting": "78ch"
                                }
                              }
                            ]
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "EventDrill",
                          "comparison": "isEqualTo",
                          "value": "Fslogix logon timeout"
                        },
                        "name": "Fslogixtimeout"
                      }
                    ]
                  },
                  "name": "EventDrillDownFroup"
                }
              ]
            },
            "name": "EventGroup",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nlet maxResultCount = 100;\r\nlet processInfo = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where ObjectName == \"Processor Information\" and CounterName == \"% Processor Time\"\r\n| summarize hint.shufflekey = Computer Average = avg(CounterValue), percentiles(CounterValue, 95) by Computer\r\n| project Computer, ProcessAverage=Average, ProcessP95th = percentile_CounterValue_95\r\n| limit maxResultCount;\r\nlet diskInfo = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where ObjectName == 'LogicalDisk' and InstanceName =~ 'c:' and CounterName in ('% Free Space')\r\n| summarize hint.shufflekey = Computer Average = avg(CounterValue), percentiles(CounterValue, 95) by Computer\r\n| project Computer, FreeSpaceAverage=Average, FreeSpaceP95th = percentile_CounterValue_95\r\n| limit maxResultCount;\r\nlet trend = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where (ObjectName == \"Processor Information\" and CounterName == \"% Processor Time\") or \r\n        (ObjectName == 'LogicalDisk' and InstanceName =~ 'c:' and CounterName in ('% Free Space'))          \r\n| make-series ProcessTrend =round(avgif(CounterValue, CounterName == \"% Processor Time\"), 2), FreeSpaceTrend = round(avgif(CounterValue, CounterName ==  '% Free Space'),2) \r\n                default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Computer\r\n| project Computer, ProcessTrend, FreeSpaceTrend;\r\nprocessInfo\r\n| join kind=leftouter diskInfo on Computer\r\n| join kind=leftouter trend on Computer\r\n| project Computer, ProcessAverage, ProcessP95th, FreeSpaceAverage, FreeSpaceP95th, ProcessTrend, FreeSpaceTrend, sortField=max_of(ProcessAverage, 100-FreeSpaceAverage)\r\n| sort by sortField desc\r\n| limit maxResultCount",
              "size": 1,
              "showAnalytics": true,
              "title": "Host Performance Overview",
              "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
              "timeContext": {
                "durationMs": 172800000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ProcessAverage",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": ">=",
                          "thresholdValue": "70",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "85",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": null,
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "ProcessP95th",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "FreeSpaceAverage",
                    "formatter": 4,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "ProcessTrend",
                    "formatter": 9,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "FreeSpaceTrend",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "sortField",
                    "formatter": 5
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "Computer"
                  },
                  {
                    "columnId": "ProcessAverage",
                    "label": "Process Average"
                  },
                  {
                    "columnId": "ProcessP95th"
                  },
                  {
                    "columnId": "FreeSpaceAverage",
                    "label": "Free Disk  Space"
                  },
                  {
                    "columnId": "FreeSpaceP95th"
                  },
                  {
                    "columnId": "ProcessTrend"
                  },
                  {
                    "columnId": "FreeSpaceTrend"
                  },
                  {
                    "columnId": "sortField"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "Alternate",
              "comparison": "isEqualTo",
              "value": "no"
            },
            "name": "hostperfoverview - Copy - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Computer Browser",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "parameters": [
                      {
                        "id": "280b8061-881a-4dc7-80db-a31161bce7a9",
                        "version": "KqlParameterItem/1.0",
                        "name": "Computer",
                        "type": 5,
                        "isRequired": true,
                        "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| distinct Computer\r\n| extend selected = 1",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": []
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 0"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "parameters": [
                            {
                              "id": "e2155896-4bea-43a8-9688-779c96c9b67f",
                              "version": "KqlParameterItem/1.0",
                              "name": "Object",
                              "type": 2,
                              "query": "Perf\r\n| where TimeGenerated {TimeRange:query}\r\n| where Computer == \"{Computer}\"\r\n| distinct ObjectName\r\n",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "value": "Processor Information",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            },
                            {
                              "id": "e2155896-4bea-43a8-9688-779c96c9b67f",
                              "version": "KqlParameterItem/1.0",
                              "name": "CounterName",
                              "label": "Counter Name",
                              "type": 2,
                              "query": "Perf\r\n| where TimeGenerated {TimeRange:query}\r\n| where Computer == \"{Computer}\" and ObjectName == \"{Object}\"\r\n| distinct CounterName\r\n",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "value": "% Processor Time",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let Trend=Perf\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\" and ObjectName == \"{Object}\" and CounterName == \"{CounterName}\"\r\n| project _ResourceId, CounterName, InstanceName, TimeGenerated, CounterValue\r\n| make-series Trend =round(avg(CounterValue), 2) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CounterName, InstanceName\r\n| project Trend, InstanceName;\r\nPerf\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\"  and ObjectName == \"{Object}\" and CounterName == \"{CounterName}\"\r\n| project _ResourceId, CounterName, InstanceName, TimeGenerated,CounterValue\r\n| summarize Average = avg(CounterValue), P95th=  percentiles(CounterValue, 95) , TimeGenerated= min(TimeGenerated) by CounterName, InstanceName\r\n| join Trend on InstanceName\r\n| project InstanceName, Average, P95th, TimeGenerated, Trend\r\n| order by Average desc",
                          "size": 1,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Average",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "P95th",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "Trend",
                                "formatter": 9,
                                "formatOptions": {
                                  "palette": "greenRed"
                                }
                              }
                            ],
                            "rowLimit": 1000
                          }
                        },
                        "name": "PerfSelectedObject"
                      }
                    ]
                  },
                  "name": "Perf by object",
                  "styleSettings": {
                    "margin": "3px",
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "cafbfcde-6e3d-4370-86a6-761270d10437",
                              "version": "KqlParameterItem/1.0",
                              "name": "EventLog",
                              "label": "Event Log",
                              "type": 2,
                              "query": "Event\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\"\r\n| distinct EventLog",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "value": "Application",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            },
                            {
                              "id": "44ebe45b-1f47-4b62-bcfb-4a43ea59dca3",
                              "version": "KqlParameterItem/1.0",
                              "name": "MinLevel",
                              "label": " Minimum Level",
                              "type": 2,
                              "value": "1",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "jsonData": "[\r\n{\"value\":0, \"label\":\"Critical\"},\r\n{\"value\":1, \"label\":\"Error\"},\r\n{\"value\":2, \"label\":\"Warning\"},\r\n{\"value\":4, \"label\":\"Information\"}\r\n]"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 5"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Event\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\" and EventLog == \"{EventLog}\" and EventLevel <= {MinLevel}\r\n| summarize Count=count() by Source, EventLevel,EventLevelName\r\n",
                          "size": 0,
                          "exportFieldName": "Source",
                          "exportParameterName": "SelectedSource",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "EventLevel",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "EventLevelName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Information",
                                      "representation": "1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Warning",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Error",
                                      "representation": "error",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Success",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "thresholdValue": "Critical",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "Source",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Source"
                              },
                              {
                                "columnId": "EventLevel"
                              },
                              {
                                "columnId": "EventLevelName",
                                "label": "Level"
                              },
                              {
                                "columnId": "Count"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "Source",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "query - 3",
                        "styleSettings": {
                          "margin": "3px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Event\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\" and EventLog == \"{EventLog}\" and EventLevel <= {MinLevel} and Source == \"{SelectedSource}\"\r\n| project TimeGenerated, EventLevel, EventLevelName, EventID, RenderedDescription\r\n| top 2000 by TimeGenerated desc",
                          "size": 0,
                          "exportFieldName": "TimeGenerated",
                          "exportParameterName": "TimeGenerated",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "EventLevel",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "EventLevelName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Information",
                                      "representation": "1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Warning",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Error",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Critical",
                                      "representation": "critical",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "thresholdValue": "Success",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "EventID",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "8ch"
                                }
                              },
                              {
                                "columnMatch": "RenderedDescription",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true,
                                  "customColumnWidthSetting": "69.5714ch"
                                }
                              }
                            ],
                            "rowLimit": 2000,
                            "sortBy": [
                              {
                                "itemKey": "EventID",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "TimeGenerated"
                              },
                              {
                                "columnId": "EventLevel",
                                "label": ""
                              },
                              {
                                "columnId": "EventLevelName",
                                "label": "Level"
                              },
                              {
                                "columnId": "EventID",
                                "label": "Id"
                              },
                              {
                                "columnId": "RenderedDescription"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "EventID",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "SelectedSource",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "query - 3",
                        "styleSettings": {
                          "margin": "3px",
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "name": "EventsBrowser",
                  "styleSettings": {
                    "margin": "3px",
                    "showBorder": true
                  }
                }
              ]
            },
            "name": "Computer Browser",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nlet maxResultCount = 100;\r\nlet processInfo = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where ObjectName == \"Processor Information\" and CounterName == \"% Processor Time\"\r\n| summarize hint.shufflekey = Computer Average = avg(CounterValue), percentiles(CounterValue, 95) by Computer\r\n| project Computer, ProcessAverage=Average, ProcessP95th = percentile_CounterValue_95\r\n| limit maxResultCount;\r\nlet trend = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where (ObjectName == \"Processor Information\" and CounterName == \"% Processor Time\")         \r\n| make-series ProcessTrend =round(avg(CounterValue), 2) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Computer\r\n| project Computer, ProcessTrend;\r\nprocessInfo\r\n| join kind=leftouter trend on Computer\r\n| project Computer, ProcessAverage, ProcessP95th , ProcessTrend\r\n| sort by ProcessAverage desc\r\n| limit maxResultCount",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "CPU usage",
                    "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Computer",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "45ch"
                          }
                        },
                        {
                          "columnMatch": "ProcessAverage",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": ">=",
                                "thresholdValue": "70",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">=",
                                "thresholdValue": "85",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": null,
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "12.8571ch"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "ProcessP95th",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "10.7143ch"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "ProcessTrend",
                          "formatter": 9,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "287px"
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "Computer"
                        },
                        {
                          "columnId": "ProcessAverage",
                          "label": "Average"
                        },
                        {
                          "columnId": "ProcessP95th",
                          "label": "P95th"
                        },
                        {
                          "columnId": "ProcessTrend"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "cpu usage",
                  "styleSettings": {
                    "margin": "5px",
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nlet maxResultCount = 100;\r\nlet diskInfo = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where ObjectName == 'Memory'  and CounterName =~ \"Available MBytes\"\r\n| summarize hint.shufflekey = Computer Average = avg(CounterValue), percentiles(CounterValue, 95) by Computer\r\n| project Computer, Average, P95th = percentile_CounterValue_95\r\n| limit maxResultCount;\r\nlet trend = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where ObjectName == 'Memory'  and CounterName =~ \"Available MBytes\"          \r\n| make-series  Trend = round(avg(CounterValue),1) \r\n                default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Computer\r\n| project Computer, Trend;\r\ndiskInfo\r\n| join kind=leftouter trend on Computer\r\n| project Computer,  Average, P95th, Trend\r\n| sort by Average asc\r\n| limit maxResultCount",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Available Memory",
                    "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                    "timeContext": {
                      "durationMs": 172800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Computer",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "45ch"
                          }
                        },
                        {
                          "columnMatch": "Average",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0} {1}"
                              },
                              {
                                "operator": "<=",
                                "thresholdValue": "15",
                                "representation": "2",
                                "text": "{0} {1}"
                              },
                              {
                                "operator": "<=",
                                "thresholdValue": "10",
                                "representation": "critical",
                                "text": "{0} {1}"
                              }
                            ],
                            "customColumnWidthSetting": "14.2857ch"
                          },
                          "numberFormat": {
                            "unit": 4,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "P95th",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "11.5714ch"
                          },
                          "numberFormat": {
                            "unit": 4,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 9,
                          "formatOptions": {
                            "palette": "redGreen",
                            "customColumnWidthSetting": "255px"
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_thresholds_Average_1",
                          "sortOrder": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "Computer"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_thresholds_Average_1",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "Available Memory",
                  "styleSettings": {
                    "margin": "5px",
                    "showBorder": true
                  }
                }
              ]
            },
            "name": "cpu + disk space"
          }
        ]
      },
      "name": "HostPerformance"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
